"use strict";var Objs;!function(e){var r=function(){function e(){}return e.isDefined=function(e){return void 0!==e&&null!==e},e.isArray=function(e){return e instanceof Array},e.isFunction=function(e){return"function"==typeof e},e.isNative=function(e){return this.isPrimitive(e)||this.isDate(e)||this.isArray(e)||this.isFunction(e)},e.isPrimitive=function(e){if(void 0===e||null===e)return!0;switch(typeof e){case"string":case"number":case"boolean":return!0}return!1},e.isDate=function(e){return e instanceof Date},e.areSameTypes=function(e,r){return typeof e==typeof r&&this.isArray(e)===this.isArray(r)},e.getHashCode=function(e){return this.getStringHashCode("string"==typeof e?e:JSON.stringify(e,void 0,0))},e.getStringHashCode=function(e){var r=e.length;if(0===r)return 0;var n,t,i=0;for(n=0;r>n;n++)t=e.charCodeAt(n),i=(i<<5)-i+t,i|=0;return i},e}();e.Types=r}(Objs||(Objs={}));var Objs;!function(e){var r;!function(r){var n=function(){function r(){}return r.checkAndPrepareTargetForCloning=function(r,n){if(!e.Types.isDefined(r))throw new Error("source is not defined");if(!e.Types.isDefined(n))throw new Error("target is not defined");if(!e.Types.areSameTypes(r,n))throw new Error("source and target types varies");if(e.Types.isPrimitive(r))throw new Error("could not act on a primitive value");if(e.Types.isPrimitive(n))throw new Error("could not act on a primitive value");if(r===n)throw new Error("could not act on same instances");var t=Object.keys(r),i=Object.keys(n);i.forEach(function(e){t.indexOf(e)<0&&delete n[e]})},r.shallowCloneTo=function(r,n){if(this.checkAndPrepareTargetForCloning(r,n),e.Types.isArray(n)){var t=n;t.splice(0,t.length);for(var i=r,o=i.length,s=0;o>s;++s)t[s]=this.shallowClone(i[s]);return n}return Object.assign(n,this.shallowClone(r))},r.deepCloneTo=function(r,n){if(this.checkAndPrepareTargetForCloning(r,n),e.Types.isArray(n)){var t=n;t.splice(0,t.length);for(var i=r,o=i.length,s=0;o>s;++s)t[s]=this.deepClone(i[s]);return n}return Object.assign(n,this.deepClone(r))},r.shallowClone=function(r){if(e.Types.isArray(r)){for(var n=r,t=n.length,i=new Array(n.length),o=0;t>o;++o){var s=n[o];e.Types.isArray?i[o]=new Array(s):i[o]=this.cloneNonArray(s,!1)}return i}return this.cloneNonArray(r,!1)},r.cloneNonArray=function(r,n){if(!e.Types.isPrimitive(r)){if(e.Types.isFunction(r))return r;if(e.Types.isDate(r))return new Date(r.getTime());var t=Object.create(r);for(var i in r)r.hasOwnProperty(i)&&(t[i]=n?this.deepClone(r[i]):r[i]);return t}switch(typeof r){case"string":return void 0!==r&&null!==r?""+r:r;default:return r}},r.deepClone=function(e){var r=new Map,n=this.deepCloneWithCyclesHandling(e,r);return r.clear(),n},r.deepCloneWithCyclesHandling=function(r,n){var t=typeof r;if(("object"===t||"array"===t)&&n.has(r))return n.get(r);if(e.Types.isArray(r)){var i=r,o=i.length,s=[];n.set(r,s);for(var a=0;o>a;++a)s[a]=this.deepCloneWithCyclesHandling(i[a],n);return s}return this.cloneNonArrayWithCyclesHandling(r,!0,n)},r.cloneNonArrayWithCyclesHandling=function(r,n,t){if(!e.Types.isPrimitive(r)){if(e.Types.isFunction(r))return r;if(t.has(r))return t.get(r);if(e.Types.isDate(r)){var i=new Date(r.getTime());return t.set(r,i),i}var o=Object.create(r);t.set(r,o);for(var s in r)r.hasOwnProperty(s)&&(o[s]=n?this.deepCloneWithCyclesHandling(r[s],t):r[s]);return o}switch(typeof r){case"string":return void 0!==r&&null!==r?""+r:r;default:return r}},r}();r.Cloner=n}(r=e.Cloning||(e.Cloning={}))}(Objs||(Objs={}));var Objs;!function(e){var r;!function(r){var n=function(){function r(){}return r.areEquivalent=function(e,r,n){var t=new Map,i=this.checkForEquivalence(e,r,t,n);return t.forEach(function(e){e.clear()}),t.clear(),i},r.storeProcessedEquivalenceComparison=function(e,r,n,t){var i;t.has(e)?i=t.get(e):(i=new Map,t.set(e,i)),i.set(r,n)},r.checkForEquivalence=function(r,n,t,i){var o=typeof r;if(("object"===o||"array"===o)&&t.has(r)){var s=t.get(r);if(s.has(n))return s.get(n)}if(i=i||this.defaultClonesComparisonOptions,r===n||void 0===r&&void 0===n||null===r&&null===n)return!0;if(null===r||void 0===r)return!1;if(null===n||void 0===n)return!1;if(!e.Types.areSameTypes(r,n))return!1;if(e.Types.isArray(r)){var a=r,u=n,c=a.length,h=u.length;if(c!==h)return!1;this.storeProcessedEquivalenceComparison(r,n,!0,t);for(var f=0;c>f;++f)if(!this.checkForEquivalence(a[f],u[f],t,i))return this.storeProcessedEquivalenceComparison(r,n,!1,t),!1;return!0}var l=e.Types.isNative(r),p=e.Types.isNative(n);if(l&&p)return!(!e.Types.isDate(r)||!e.Types.isDate(n))&&r.getTime()===n.getTime();var d=i.isPropertyExcluded,y=d?Object.keys(r).filter(function(e){return!d(e,r[e])}):Object.keys(r),v=d?Object.keys(n).filter(function(e){return!d(e,n[e])}):Object.keys(n),g=y.length,C=v.length;if(g!==C){if(!i.ignoreMissingPropertyWhenUndefined)return!1;if(y=y.filter(function(e){return void 0!==r[e]||n.hasOwnProperty(e)}),v=v.filter(function(e){return void 0!==n[e]||r.hasOwnProperty(e)}),g=y.length,C=v.length,g!==C)return!1}this.storeProcessedEquivalenceComparison(r,n,!0,t);for(var f=0;g>f;++f){var w=y[f];if(v.indexOf(w)<0)return this.storeProcessedEquivalenceComparison(r,n,!1,t),!1;if(!this.checkForEquivalence(r[w],n[w],t,i))return this.storeProcessedEquivalenceComparison(r,n,!1,t),!1}return!0},r}();n.defaultClonesComparisonOptions={isPropertyExcluded:void 0,ignoreMissingPropertyWhenUndefined:!1},r.Comparer=n}(r=e.Comparison||(e.Comparison={}))}(Objs||(Objs={}));var Objs;!function(e){var r;!function(r){var n;!function(e){e[e.Reference=1]="Reference",e[e.Id=2]="Id"}(n=r.IdentificationKind||(r.IdentificationKind={}));var t;!function(e){e[e.DeepClone=0]="DeepClone",e[e.ShallowClone=1]="ShallowClone"}(t=r.SnapshotKind||(r.SnapshotKind={}));var i;!function(e){e[e.LowerCamelCase=0]="LowerCamelCase",e[e.UpperCamelCase=1]="UpperCamelCase"}(i=r.PropertyNameCasingKind||(r.PropertyNameCasingKind={}));var o=function(){function r(e){if(null===e)throw new Error("configuration can not be null");if(e=e||r.defaultConfiguration,e.historyDepth<1)throw new Error("historyDepth could not be less than 1");this.snapshots=new Map,this.configuration=e}return r.prototype.getCasedIdPropertyName=function(){switch(this.configuration.propertyNameCasingKind){case i.LowerCamelCase:return"id";case i.UpperCamelCase:return"Id";default:throw new Error("unsupported casing")}},r.prototype.clearAll=function(){return this.snapshots.forEach(function(e){e.splice(0,e.length)}),this.snapshots.clear(),this},r.prototype.getIdentifier=function(e){switch(this.configuration.identificationKind){case n.Reference:return e;case n.Id:return e[this.getCasedIdPropertyName()];default:throw new Error("unhandled identification kind")}},r.prototype.getObjectDefinedErrorMessage=function(r){return e.Types.isDefined(r)?this.configuration.identificationKind!==e.Snapshots.IdentificationKind.Id||r.hasOwnProperty(this.getCasedIdPropertyName())?e.Types.isPrimitive(r)?"could not act on a primitive value":"":"value does not defined an '"+this.getCasedIdPropertyName()+"' property":"value is not defined"},r.prototype.ensureObjectDefinedOrThrow=function(e){var r=this.getObjectDefinedErrorMessage(e);if(r)throw new Error(r)},r.prototype.getHistory=function(e){var r=this.getIdentifier(e);if(this.snapshots.has(r))return this.snapshots.get(r)},r.prototype.getHistoryOrThrow=function(e){var r=this.getHistory(e);if(void 0===r)throw new Error("value has no snapshots");return r},r.prototype.has=function(e){var r=this.getObjectDefinedErrorMessage(e);if(""!==r)return!1;var n=this.getHistory(e);return void 0!==n&&n.length>0},r.prototype.count=function(e){var r=this.getObjectDefinedErrorMessage(e);if(""!==r)return 0;var n=this.getHistory(e);return void 0===n?0:n.length},r.prototype.isChanged=function(r,n){this.ensureObjectDefinedOrThrow(r);var t=this.getHistoryOrThrow(r);if(0===t.length)throw new Error("value has no snapshots");var i=t[0];return!e.Comparison.Comparer.areEquivalent(r,i,n)},r.prototype.clone=function(r){switch(this.configuration.snapshotKind){case t.DeepClone:return e.Cloning.Cloner.deepClone(r);case t.ShallowClone:return e.Cloning.Cloner.shallowClone(r);default:throw new Error("unhandled snapshot kind")}},r.prototype.cloneTo=function(r,n){switch(this.configuration.snapshotKind){case t.DeepClone:return e.Cloning.Cloner.deepCloneTo(r,n);case t.ShallowClone:return e.Cloning.Cloner.shallowCloneTo(r,n);default:throw new Error("unhandled snapshot kind")}},r.prototype.save=function(r){this.ensureObjectDefinedOrThrow(r);var n=this.getHistory(r);if(void 0===n)return this.snapshots.set(this.getIdentifier(r),[this.clone(r)]),this;if(e.Comparison.Comparer.areEquivalent(r,n[0]))return this;var t=this.clone(r),i=n.unshift(t);return i>this.configuration.historyDepth&&n.pop(),this},r.prototype.clear=function(e){this.ensureObjectDefinedOrThrow(e);var r=this.getHistoryOrThrow(e);return r.splice(0,r.length,this.clone(e)),this},r.prototype.peek=function(e){this.ensureObjectDefinedOrThrow(e);var r=this.getHistoryOrThrow(e);if(0===r.length)throw new Error("snapshot could not be peeked");return r[0]},r.prototype.revert=function(e){this.ensureObjectDefinedOrThrow(e);var r=this.getHistoryOrThrow(e);if(0===r.length)throw new Error("value could not be more reverted");return this.cloneTo(r.shift(),e)},r}();o.defaultConfiguration={historyDepth:7,identificationKind:n.Reference,snapshotKind:t.DeepClone,propertyNameCasingKind:i.LowerCamelCase},r.Snapshotter=o}(r=e.Snapshots||(e.Snapshots={}))}(Objs||(Objs={}));
//# sourceMappingURL=ob.min.js.map